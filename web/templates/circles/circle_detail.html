{% extends "base.html" %}
{% block title %}{{ circle.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h2 class="h4 mb-1">{{ circle.name }}</h2>
    <div class="text-muted small">
      {% if circle.is_public %}Public{% else %}Private{% endif %}
      • {{ member_count }} member{{ member_count|pluralize }}
    </div>
    {% if circle.description %}
      <p class="mt-2">{{ circle.description }}</p>
    {% endif %}
  </div>

  <div class="d-flex gap-2">
    {% if request.user.is_authenticated %}
      {% if is_member %}
        <form method="post" action="{% url 'circles:circle_leave' slug=circle.slug %}">
          {% csrf_token %}
          <button class="btn btn-outline-secondary">Leave</button>
        </form>
        <a class="btn btn-primary" href="{% url 'circles:post_create' slug=circle.slug %}">Create Post</a>
      {% else %}
        <form method="post" action="{% url 'circles:circle_join' slug=circle.slug %}">
          {% csrf_token %}
          <button class="btn btn-outline-primary">Join</button>
        </form>
      {% endif %}
    {% else %}
      <a class="btn btn-outline-primary" href="/admin/login/?next={{ request.path }}">Log in</a>
    {% endif %}
  </div>
</div>

<hr class="my-4">

<h4 class="mb-3">Recent Posts</h4>

{% if posts %}
  <div class="list-group">
    {% for p in posts %}
      <a href="{% url 'circles:post_detail' slug=circle.slug pk=p.pk %}" class="list-group-item list-group-item-action">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">{{ p.title }}</h5>
          <small class="text-muted">{{ p.created_at|date:"M j, Y, g:i a" }}</small>
        </div>
        <p class="mb-1 text-truncate">
          {% if p.body %}{{ p.body|truncatewords:25 }}
          {% elif p.link_url %}{{ p.link_url }}
          {% else %}<span class="text-muted">No content</span>{% endif %}
        </p>
        <small class="text-muted">by {{ p.author }} • Score: {{ p.score_total }}</small>
      </a>
    {% endfor %}
  </div>
{% else %}
  <p class="text-muted">No posts yet.</p>
{% endif %}

{% endblock %}